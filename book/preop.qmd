---
subtitle: "Injury Recovery & Readiness for Surgery"
params:
  athlete: "Frank Reynolds"
bibliography: references.bib
---

# Pre-Op Phase {#sec-pre-op-phase .unnumbered}

```{r setup-root, include=FALSE}
knitr::opts_knit$set(root.dir = normalizePath(".."))
```

```{r}
source("Global.R")
source("plot_functions.R")
source("Themes.R")
```

This chapter will focus exclusively on the time period between ACL injury and ACL Repair surgery (ACLR) and the objectives associated with the best outcomes throughout the rehabilitation. It is not always possible to choose the exact date of surgery, and the selection of the optimal pre-ACLR window is beyond the scope of this protocol, rather the goal here is to provide the information and tools to optimize this phase of the rehab. As seen below, **`r params$athlete`** has **`r prehab` days** to prepare for surgery.

```{r}
phase0_length <- tibble(
  'Injury Date ' = injury_date,
  'Surgery Date' = surgery_date,
  'Prehab Window' = paste0(as.numeric(difftime(Rehab_Info$date_of_surgery, Rehab_Info$date_of_injury, units = "days")), " Days")
  ) %>% gt() %>%
  ak_gt_theme3() %>%
  cols_align(align = "center")

phase0_length
```

Regardless of the length of the prehab window, the research is clear that the length of time between injury and surgery is far less important than the quality of pre-ACLR care provided @young2023. Current research has found the following most important areas of focus at this stage:

::: {.callout-important title="Most Important Goals — Pre-Op"}
-   Reduce pain and swelling
-   Regain range of motion
-   Regain quadriceps and hamstring strength
:::

**`r params$athlete`'s** progress towards these goals will be assessed via the criteria seen below. Detailed description of each criteria and the associated testing methodology can be found in the @sec-phase0testing section.

```{r}

phase0_criteria <- readxl::read_xlsx("sample_data/acl-protocol-criteria-2025.xlsx", sheet="Phase0") %>%
  clean_names()
#phase0_criteria <- readxl::read_xlsx("acl-protocol-criteria-2025.xlsx", sheet="Phase0") %>%
  #clean_names()

# Helpers for parsing numbers and percents
parse_num <- function(x) {
  if (is.numeric(x)) return(x)
  s <- as.character(x)
  suppressWarnings(as.numeric(str_extract(s, "-?\\d+\\.?\\d*")))
}
is_percent <- function(x) grepl("%", as.character(x))

# Prep data: normalize operators, parse numbers, and decide if goal is met
phase0_prepped <- phase0_criteria %>%
  mutate(
    # Normalize operators like ≥ ≤ to R-friendly >= <=
    op_clean = trimws(operator),
    op_clean = dplyr::recode(op_clean,
      "≥" = ">=", "≤" = "<=", "=" = "==", "=>" = ">=", "=<" = "<="
    ),

    # Raw values for potential string-equality comparisons
    score_raw = score,
    goal_raw  = goal,

    # Numerics (pull first numeric token)
    score_num = parse_num(score),
    goal_num  = parse_num(goal),

    # Percent handling: if Goal shows %, compare in 0–100 space
    score_num = dplyr::case_when(
      is_percent(goal_raw) & !is.na(score_num) & score_num <= 1 ~ score_num * 100,
      TRUE ~ score_num
    ),

    # For text equality goals (e.g., "Pass"), allow == to compare strings
    meets_string = dplyr::case_when(
      op_clean == "==" ~ tolower(trimws(as.character(score_raw))) ==
                          tolower(trimws(as.character(goal_raw))),
      TRUE ~ NA
    ),

    # Final meets_goal logic (numeric first; fall back to string equality)
    meets_goal = dplyr::case_when(
      !is.na(score_num) & !is.na(goal_num) & op_clean == ">=" ~ score_num >= goal_num,
      !is.na(score_num) & !is.na(goal_num) & op_clean == ">"  ~ score_num >  goal_num,
      !is.na(score_num) & !is.na(goal_num) & op_clean == "<=" ~ score_num <= goal_num,
      !is.na(score_num) & !is.na(goal_num) & op_clean == "<"  ~ score_num <  goal_num,
      !is.na(meets_string) ~ meets_string,
      TRUE ~ NA
    )
  )

# Some nice percentage formatting
phase0_prepped <- phase0_prepped %>%
  mutate(
    goal  = ifelse(grepl("^0?\\.\\d+$", goal),  paste0(as.numeric(goal)  * 100, "%"), goal),
    score = ifelse(grepl("^0?\\.\\d+$", score), paste0(as.numeric(score) * 100, "%"), score)
  )


# Build gt + Score coloring
tbl <- phase0_prepped %>%
  select(
    outcome_measure,
    operator, goal, score, meets_goal
  ) %>%
  gt() %>%
  cols_label(
    outcome_measure = "Outcome Measure",
    #`Display Description` = "Display Description",
    #Info = "",
    goal = "Goal",
    operator = "",
    score = "Score"
  ) %>%
  cols_align(align = "center", columns = c(goal, operator, score)) %>%
  ak_gt_theme3() %>%
  cols_width(
    outcome_measure ~ px(260),
    goal ~ px(90),
    operator ~ px(60),
    score ~ px(100)
  ) %>%
  #tab_options(table.font.size = px(14), data_row.padding = px(6)) %>%
  # Color Score cell by pass/fail/NA
  tab_style(
    style = list(
      cell_fill(color = "#E8F5E9"),   # light green
      cell_text(color = "#1B5E20", weight = "600")
    ),
    locations = cells_body(columns = score, rows = meets_goal %in% TRUE)
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#FFF9C4"),   # light yellow
      cell_text(color = "#7A6A00", weight = "600")
    ),
    locations = cells_body(columns = score, rows = meets_goal %in% FALSE)
  ) %>%
  tab_style(
    style = list(
      cell_fill(color = "#ECEFF1"),   # light grey for NA/uncomparable
      cell_text(color = "#455A64")
    ),
    locations = cells_body(columns = score, rows = is.na(meets_goal))
  ) %>%
  # Hide helper column
  cols_hide(columns = meets_goal)



tbl

```

```{r}

goals_progress_bar <- function(met, total, label = "Goals met", width = "100%") {
  pct <- if (total > 0) round(100 * met / total) else 0
  tagList(
    # minimal CSS (injected once)
    tags$style(HTML("
      .ak-pb-wrap { margin-top:10px; }
      .ak-pb-meta { display:flex; justify-content:space-between; font-size:0.9rem; margin-bottom:6px; }
      .ak-pb { background:#f0f2f5; border:1px solid #dadde1; border-radius:10px; height:14px; overflow:hidden; }
      .ak-pb__fill { height:100%; background:linear-gradient(90deg,#4CAF50,#2E7D32); }
    ")),
    div(class = "ak-pb-wrap",
      div(class = "ak-pb-meta",
          span(sprintf("%s: %d/%d", label, met, total)),
          span(sprintf("%d%%", pct))
      ),
      div(
        class = "ak-pb",
        role = "progressbar",
        `aria-valuemin` = "0",
        `aria-valuemax` = "100",
        `aria-valuenow` = pct,
        style = sprintf("width:%s;", width),
        div(class = "ak-pb__fill", style = sprintf("width:%d%%;", pct))
      )
    )
  )
}

met_n   <- sum(phase0_prepped$meets_goal %in% TRUE, na.rm = TRUE)
total_n <- nrow(phase0_prepped)

goals_progress_bar(met_n, total_n)


```

------------------------------------------------------------------------

## What does the research say? {#preop-outcomes}

Recent systematic reviews support the implementation of an appropriate prehab exercise program prior to surgery, while highlighting the importance of allowing the knee to regain normal physiologic motion, and describing relevant protocols and strategies [@giesche2020; @carter2020; @zakharia2025]. The first two systematic reviews were published in 2020 and included 6 and 3 studies respectively, whereas the most recent review published in 2025 included 36 different studies, highlighting the recent explosion of interest in ACLR prehab @zakharia2025. This review described both the characteristics of current ACLR prehab programs in the literature and the clinical outcomes that have been reported pre- and post-surgery. The results show that current ACLR prehab practices emphasize impairment resolution (i.e. pain and swelling), ROM restoration and neuromuscular exercises, and that these criteria are associated with improved short and long-term clinical outcomes.

Among studies comparing patients who completed a prehab program to those who did not, results suggest that prehab is a potentially effective intervention for yielding short- to long-term post-operative functional benefits. The Knee Injury and Osteoarthritis Outcome Score (KOOS) is a validated self-assessment tool used to score pain, function in activities of daily living, function in sport/recreation, knee related quality of life, and "other symptoms" @roos1998. Individuals participating in ACLR prehab are shown to have significantly better KOOS outcome scores pre-operatively and at two years @grindem2015 and 10 years @urhausen2024 post-operation. These results are also associated with notably faster recovery of knee function, ROM and knee-extensor strength @shaarani2013 and further supported by evidence that limited knee ROM prior to ACLR has been associated with delays in the recovery of knee ROM post-surgery @quelard2010. A further notable finding from the systematic reviews is that there were no reported incidents of preoperative complications arising from any of the studies, indicating that prehab is a safe method of improving post-operative outcomes @zakharia2025.

> *People who attain full range of motion, good quadriceps and hamstring strength, and minimal swelling prior to surgery have better outcomes than those who don’t up to 2 years post surgery @cooper2018.*

While it seems clear that ACLR prehab can be a potentially effective intervention, there remains a need for further research in this area, particularly regarding specific exercise details and protocol progression. It must be noted that there is currently no consensus or gold-standard ACLR Prehab program, likely because there are too many variables to consider for each individual. There are, however, a few published protocols [@eitzen2010; @wilk2016; @cunha2022], and these have been used to inform the CSI Pacific ACLR Phase 0 testing and training protocols.

## Testing {#sec-phase0testing}

Each card below contains a detailed description of the tests to be conducted during this phase of rehab.

```{r, echo=FALSE, results='asis'}


tests <- phase0_criteria |>
  dplyr::select(outcome_measure, display_description, additional_information, goal, repetitions, calculation)

# for (i in seq_len(nrow(tests))) {
#   cat('::: {.card .ak-card .has-stripe .accent-primary}\n')
#   cat('### ', tests$outcome_measure[i], '\n\n', sep = '')
#   cat(tests$display_description[i], '\n\n')
#   cat(tests$additional_information[i], '\n\n')
#   cat('**Criteria:** ', tests$goal[i], '\n\n', sep = '')
#   cat(':::\n\n')
# }

# Helper: print a label/value line only if value is non-missing & non-empty
emit_field <- function(label, value) {
  if (length(value) == 0 || all(is.na(value))) return(invisible())
  val <- value[[1]]
  if (is.na(val)) return(invisible())
  val_chr <- trimws(as.character(val))
  if (!nzchar(val_chr)) return(invisible())
  cat("**", label, ":** ", val_chr, "\n\n", sep = "")
}

for (i in seq_len(nrow(tests))) {
  cat('::: {.card .ak-card .has-stripe .accent-primary}\n')       # your universal card class
  cat('### ', tests$outcome_measure[i], '\n\n', sep = '')         # heading
  if (!is.na(tests$display_description[i]) &&
      nzchar(trimws(tests$display_description[i]))) {
    cat(tests$display_description[i], '\n\n')
  }
  cat("*", tests$additional_information[i], '\n\n')
  emit_field("Criteria",    tests$goal[i])                       # always optional-safe
  emit_field("Repetitions", tests$repetitions[i])                # only prints if present
  emit_field("Calculation", tests$calculation[i])

  cat(':::\n\n')
}

```

## The Program

Below you will find links to your training programs.

[Pre-Op: Meso 1](https://www.teambuildr.com/)

Exercises and activities during this phase typically include regular icing of the knee to reduce swelling, range of motion exercises, low impact aerobic exercise such as cycling, and a progressive strengthening regime. Strength exercises should progress in parallel with the clinical condition of the knee. As the pain & swelling settles, and the range of motion increases, strength exercise can progress to include weighted exercises in the gym and jump and land activities such as hopping drills. Aggressive change of direction activities should be avoided during this phase.

## Additional Resources

### Blood Flow Restriction

dkjfhkjfdhf

### Neuromuscular Electrical Stimulation

sakjhdsjkhdkjashd
